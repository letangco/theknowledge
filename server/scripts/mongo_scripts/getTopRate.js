function (a,b,c,d,e,f,g){switch(Number(e)){case 0:e=[null,0,1,2,3];break;case 1:e=[1,2,3];break;case 2:e=[null,0];break;default:e=[null,0,1,2,3]}c=Number(c),a=new RegExp(a.trim().split(/[ ,]+/).join(".*$|")+".*$");var h=[{$or:[{"categories.skills.skill_ID":{$regex:a,$options:"xi"}},{"categories.department.title":{$regex:a,$options:"xi"}},{"categories.industry.title":{$regex:a,$options:"xi"}}]}];h.push({online:{$in:e}}),h.push({active:1}),h.push({expert:1}),f&&h.push({"languageSupport.langCode":f}),g&&h.push({"country.ISO2":g}),b&&h.push({"categories.industry.industryID":b});var i=db.users.aggregate([{$project:{cuid:"$cuid",serviceTotalRate:{$add:["$serviceRating.expertCommunication","$serviceRating.serviceAsDescribed","$serviceRating.professional","$serviceRating.notProlong"]},average:Number("$categories.skills.average"),totalRate:Number("$categories.skills.totalRate"),totalConnection:"$totalConnection",skills:"$categories.skills.skill_ID",categories:"$categories",serviceRating:"$serviceRating",skillTags:"$categories.skills",country:"$country",online:"$online",country:"$country",languageSupport:"$languageSupport",priceCall:"$priceCall",priceChat:"$priceChat",avatar:"$avatar",lastName:"$lastName",firstName:"$firstName",count:{$literal:1},rate:"$rate",expert:"$expert",active:"$active",totalRateIC:"$totalRate"}},{$unwind:"$categories"},{$unwind:"$categories.skills"},{$match:{$and:h}},{$project:{cuid:"$cuid",serviceRating:"$serviceRating",serviceTotalRate:{$add:["$serviceRating.expertCommunication","$serviceRating.serviceAsDescribed","$serviceRating.professional","$serviceRating.notProlong"]},average:"$categories.skills.average",totalRate:Number("$categories.skills.totalRate"),totalConnection:"$totalConnection",skills:"$categories.skills.skill_ID",categories:"$categories.department.title",skillTags:"$skillTags",country:"$country",languageSupport:"$languageSupport",online:"$online",priceCall:"$priceCall",priceChat:"$priceChat",avatar:"$avatar",lastName:"$lastName",firstName:"$firstName",count:{$literal:1},rate:"$rate",expert:"$expert",active:"$active",totalRateIC:"$totalRate"}},{$unwind:"$skillTags"},{$unwind:"$skillTags"},{$group:{_id:{cuid:"$cuid",country:"$country",languageSupport:"$languageSupport",online:"$online",priceCall:"$priceCall",priceChat:"$priceChat",avatar:"$avatar",lastName:"$lastName",firstName:"$firstName",serviceRating:"$serviceRating",serviceTotalRate:{$add:["$serviceRating.expertCommunication","$serviceRating.serviceAsDescribed","$serviceRating.professional","$serviceRating.notProlong"]},totalConnection:"$totalConnection",rate:"$rate",expert:"$expert",active:"$active",totalRateIC:"$totalRateIC"},skillTags:{$addToSet:"$skillTags"},average:{$sum:"$average"},totalRate:{$sum:"$totalRate"},skills:{$addToSet:"$skills"},categories:{$addToSet:{title:"$categories"}},point:{$sum:{$multiply:["$average","$totalRate"]}},count:{$sum:"$count"}}},{$project:{_id:"$_id",totalRate:"$totalRate",point:"$point",skills:"$skills",categories:"$categories",skillTags:"$skillTags",Experience:"$Experience",numberOfConnection:"$numberOfConnection",rate:"$rate",expert:"$expert",active:"$active",totalRateIC:"$totalRateIC",serviceRating:"$serviceRating",serviceTotalRate:{$add:["$serviceRating.expertCommunication","$serviceRating.serviceAsDescribed","$serviceRating.professional","$serviceRating.notProlong"]},rank:{$sum:{$subtract:[{$divide:[{$sum:"$average"},{$sum:"$count"}]},{$mod:[{$divide:[{$sum:"$average"},{$sum:"$count"}]},1]}]}}}},{$sort:{rank:-1,point:-1}}]).toArray();switch(Number(d)){case 2:i=i.sort(function(a,b){return b._id.serviceTotalRate>a._id.serviceTotalRate});break;case 3:i=i.sort(function(a,b){return b._id.totalConnection<a._id.totalConnection});break;case 4:i=i.sort(function(a,b){return b._id.priceCall<a._id.priceCall}),i=i.reverse()}return{array:i.slice(10*(c-1),10*c),page:Math.ceil(i.length/10),total:i.length}}